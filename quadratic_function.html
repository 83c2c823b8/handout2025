<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>二次関数ジェネレーター</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: sans-serif;
      background-color: #f9f9f9;
    }

    .container {
      max-width: 90%;
      width: 500px;
      text-align: center;
      padding: 20px;
      border: 2px solid #ccc;
      border-radius: 12px;
      background-color: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    button {
      margin: 10px;
      padding: 10px 16px;
      font-size: 16px;
      border-radius: 6px;
      border: none;
      background-color: #4CAF50;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background-color: #45a049;
    }

    #answer p {
      margin: 8px 0;
    }

    .math {
      font-size: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>二次関数ジェネレーター</h1>
    <p id="equation" class="math">式: </p>

    <button onclick="revealAnswer()">答えを見る</button>
    <button onclick="newProblem()">次の問題</button>

    <div id="answer" style="display:none;">
      <p id="completed" class="math"></p>
      <p id="axis" class="math"></p>
      <p id="vertex" class="math"></p>
    </div>
  </div>

  <script>
    let a, b, c;

    function generateRandomQuadratic() {
      do {
        a = Math.floor(Math.random() * 9 + 1) * (Math.random() < 0.5 ? 1 : -1);
      } while (a === 0);
      b = Math.floor(Math.random() * 21 - 10);
      c = Math.floor(Math.random() * 21 - 10);

      const aStr = a === 1 ? "x^2" : a === -1 ? "-x^2" : `${a}x^2`;
      const bStr = b === 0 ? "" : b === 1 ? "+ x" : b === -1 ? "- x" : (b > 0 ? `+ ${b}x` : `- ${Math.abs(b)}x`);
      const cStr = c === 0 ? "" : (c > 0 ? `+ ${c}` : `- ${Math.abs(c)}`);

      const tex = `f(x) = ${aStr} ${bStr} ${cStr}`.replace(/\s+/g, ' ').trim();
      document.getElementById("equation").textContent = `式: \\(${tex}\\)`;
      MathJax.typeset(); // 数式再描画
    }

    function gcd(m, n) {
      return n === 0 ? m : gcd(n, m % n);
    }

    function toFraction(numerator, denominator) {
      if (denominator === 0) return 'undefined';
      const sign = (numerator * denominator < 0) ? '-' : '';
      numerator = Math.abs(numerator);
      denominator = Math.abs(denominator);
      const d = gcd(numerator, denominator);
      const num = numerator / d;
      const den = denominator / d;
      if (den === 1) return sign + num;
      return sign + `\\frac{${num}}{${den}}`;
    }

    function revealAnswer() {
      const h_num = -b;
      const h_den = 2 * a;
      const h_frac = toFraction(h_num, h_den);
      const h = h_num / h_den;
      const k_val = a * h * h + b * h + c;

      const k_num = a * h_num * h_num + 2 * a * b * h_num + 4 * a * c;
      const k_den = 4 * a;
      const k_frac = toFraction(k_num, k_den);

      const innerSign = h_num > 0 ? '-' : '+';
      const innerAbs = toFraction(Math.abs(h_num), Math.abs(h_den));
      const kSign = k_val >= 0 ? '+' : '-';
      const kAbs = k_frac.replace('-', '');

      const aStr = a === 1 ? "" : a === -1 ? "-" : a.toString();

      document.getElementById("completed").textContent =
        `平方完成形: \\(f(x) = ${aStr}(x ${innerSign} ${innerAbs})^2 ${kSign} ${kAbs}\\)`;
      document.getElementById("axis").textContent = `軸: \\(x = ${h_frac}\\)`;
      document.getElementById("vertex").textContent = `頂点: \\(\\left(${h_frac}, ${k_frac}\\right)\\)`;

      document.getElementById("answer").style.display = "block";
      MathJax.typeset(); // 数式再描画
    }

    function newProblem() {
      generateRandomQuadratic();
      document.getElementById("answer").style.display = "none";
      document.getElementById("completed").textContent = "";
      document.getElementById("axis").textContent = "";
      document.getElementById("vertex").textContent = "";
    }

    window.onload = generateRandomQuadratic;
  </script>
</body>
</html>

